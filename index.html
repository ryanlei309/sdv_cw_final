<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SDV coursework - Yuan-Chun Lei</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <!-- <script src="scripts/plot1.js"></script> -->
    <script src="scripts/plot2.js" type = 'module'></script>
    <!-- <script type="module" src="scripts/plot3.js" ></script> -->
    <!-- <script
    let df1 = d3.csv("datasets/plot1.csv", function(data) {
        console.log(data);
        });>
    </script>
    <script
    let df2 = d3.csv("datasets/plot2.csv", function(data) {
        console.log(data);
        });>
    </script>
    <script
    let df3 = d3.csv("datasets/plot3.csv", functoin(data) {
        return {
            clade: data.clade,
            duration_days: data.duration_days,
            duration_weeks: data.duratoin_weeks
        };
    }, function(error, rows) {
        console.log(rows);
    });>
    </script> -->
    <style>
        .main {
            display: flex;
            flex-flow: column;
            align-items: center;
        }

        p {
            font-family: -apple-system, 'Times New Roman';
            width: 70ch;
        }

    </style>
</head>
<div class="main">
    <p><strong>Hello my friend! This is the third part of the coursework. This website will talk about the details of visulization implementation.</strong></p>
    <p><strong>How the data is processed:</strong> (This part is not included in the PDF due to space limit.)</p>
    <p><strong>All the data is preprocessed by python.</strong> The following link is the data preprocess file: <a href = "https://github.com/ryanlei309/sdv_cw_final/blob/main/SDV_data_preprocessing.ipynb"><code>data_preprocess.ipynb</code></a></p>
    <p><strong>Data source:</strong> <a href="https://nextstrain.org/ncov/open/global"><code>Nextstrain</code></a></p>
    
    <svg id = "circle-chart"></svg>
    
    <p>
        <strong>For the first research question,</strong> a punch card chart is created to show the development of virus mutations over time 
        and show whether there are seasonal trends in the development of virus mutation. This project uses Python to do data preprocessing
        for this circle chart. Firstly, this project extracted a unique virus clade from the original nextstrain global metadata. Afterward,
        group the original data by "season" and by "clade membership" columns. And since will be some missing values because some virus 
        clade may not be collected in some seasons. To deal with this problem, this project uses fill missing values with zero to fix this problem.
        Lastly, export the processed data frame to a CSV file. 
        Let's look at the circle chart. The x-axis each season of the years from 2019 to 2022. The y-axis is each virus clade mutation. 
        The circle means the amount of the virus mutation to be collected in a season. The larger the circle is, the greater amount of the virus
        mutation is collected.
    </p>
    
    <svg id = "line-chart"></svg>

    <p>
        <strong>For the second research question,</strong> a line chart is created to show the spreading speed of each virus mutation.
        This project uses Python to do data preprocessing for the second research question. Firstly, save the unique region to an empty 
        list. Then sort the original data by date in ascending order. Next, loop over each virus clade to filter the original 
        data frame by clade. Then count how many regions the virus of each clade be collected so far. And count the days' difference 
        since the date that the clade of the virus was collected. This allows us to know the days that each clade spread from one 
        region to at least five regions.
        The x-axis of the line plot is time, and the unit of the time is days. And the y-axis is accumulated regions. The starting point
        of the y-axis is one, not zero. And each line represents each virus clade. The larger the slope, the faster the virus spread to 
        each region.
    </p>

    <svg id = "bar-chart"></svg>
    <script type = "module">
        
        const { select, csv, scaleLinear, max, scaleBand, axisLeft, axisBottom, format} = d3
        const w = 920, h = 450
        const xAxisLabelText = 'Days';


        const svg = select("svg#bar-chart");

        const width = +svg.attr('width', w);
        const height = +svg.attr('height', h);

        const render = data => {
            const xValue = d => d.duration_days;
            const yValue = d => d.clade;
            const margin = { top: 20, right: 40, bottom: 20, left: 100};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const xScale = scaleLinear()
            .domain([0, max(data, xValue)])
            .range([0, innerWidth]);

            const yScale = scaleBand()
            .domain(data.map(yValue))
            .range([0, innerHeight])
            .padding(0.1);

            const g = svg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

            g.append('g').call(axisLeft(yScale));
            g.append('g').call(axisBottom(xScale))
            .attr('transform', `translate(0, ${innerHeight})`);

            g.selectAll('rect').data(data)
            .enter().append('rect')
                .attr('y', d => yScale(yValue(d)))
                .attr('width', d => xScale(xValue(d)))
                .attr('height', yScale.bandwidth());
        };

        csv('datasets/plot3.csv').then(data => {
            data.forEach(d => {
                d.duration_days = +d.duration_days;
            });
            render(data);
        });
    </script>

    <p>
        <strong>For the third research question,</strong> a horizontal bar chart is created to show the life cycle duration of each virus mutation.
        The data is preprocessed by using python. Firstly, sort the data by date from the oldest to the latest. Then loop over the data
        by each clade membership. Then extract the first date and the last date that the virus mutation is being collected and count 
        the date difference as virus duration days. Afterward, save the virus clade and duration days into each list respectively.
        Then combine the "clade" list and "duration days" list as a data frame then export as a CSV file. 
        The x-axis of this bar chart is time and the time unit is days. The y-axis of this bar plot is each virus mutation clade.
        The longer the bar is, the longer the life duration of the virus is. 
    </p>

</div>
    



</html>